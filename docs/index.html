<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 
      Content Security Policy: A starting point to enhance security.
      This policy allows inline styles, and scripts/fonts/styles from self and trusted CDNs.
      It should be refined for production environments.
    -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' 'unsafe-inline'; 
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; 
        font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
        img-src 'self' data:;
        connect-src 'self';">

    <title>Lyftiv - Suivi de Séance de Musculation</title>

    <!-- Preconnect to essential origins for faster resource fetching -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">

    <!-- Web App Manifest for PWA capabilities -->
    <link rel="manifest" href="manifest.json">

    <!-- 
      Optimized Font Loading: 
      - font-display: swap prevents blocking text rendering while the font loads.
    -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Using a single, consistent icon library (Font Awesome) - CORRECTED LINK -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="public/css/styles.css">

    <!-- Defer script loading to prevent render-blocking -->
    <script src="main.js" type="module" defer></script>
</head>
<body>

    <!-- 
      MAIN CONTAINER
      - Switched from <div> to <main> for better semantics.
      - This is the primary content area of the page.
    -->
    <main class="main-container">

        <header class="app-header">
            <!-- 
              HEADING HIERARCHY
              - The main title and logo are now in an <h1> for proper document structure.
            -->
            <h1>
                <img src="public/images/logo.png" alt="Logo Lyftiv" class="lyftiv-logo">
                Lyftiv
            </h1>
            <div class="theme-switcher">
                <button id="themeToggleBtn" class="btn btn--ghost" aria-label="Changer de thème">
                    <i class="fa-solid fa-circle-half-stroke" aria-hidden="true"></i>
                </button>
            </div>
        </header>
        
        <!-- 
          SESSION CONTROLS
          - Wrapped in a <fieldset> for better form semantics and accessibility.
          - The <legend> provides a caption for the group.
        -->
        <fieldset class="controls-fieldset">
            <legend class="u-visually-hidden">Contrôles de la séance</legend>
            <div class="controls">
                <div class="form-field">
                    <label for="sessionSelect" class="form-field__label">Séance:</label>
                    <select id="sessionSelect" class="form-field__select" aria-label="Sélectionner une séance d'entraînement"></select>
                </div>
                <button class="btn btn--outline" id="createNewSessionTypeBtn" aria-label="Créer une nouvelle séance">Nouvelle Séance</button>
                <button class="btn btn--danger btn--outline" id="deleteCurrentSessionBtn" aria-label="Supprimer la séance actuelle" title="Supprimer la séance actuelle (personnalisée)">
                    <i class="fa-solid fa-trash-can" aria-hidden="true"></i>
                    <span>Supprimer</span>
                </button>
            </div>
        </fieldset>
        
        <section aria-labelledby="progress-label">
            <h2 id="progress-label" class="u-visually-hidden">Progression de la séance</h2>
            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="progressBar">
              <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
        </section>
        
        <!-- 
          EXERCISE LIST
          - Added a placeholder state for when the list is empty or loading.
          - The JS will replace this content with the actual exercise list.
        -->
        <section id="exerciseListContainer" class="exercise-list-container" aria-live="polite">
            <div class="placeholder-card">
                <div class="skeleton skeleton--title"></div>
                <div class="skeleton skeleton--text"></div>
                <div class="skeleton skeleton--text"></div>
                <p>Ajoutez un exercice pour commencer votre séance.</p>
            </div>
        </section>
        
        <section class="add-exercise-section" aria-labelledby="add-exercise-heading">
            <h2 id="add-exercise-heading" class="u-visually-hidden">Ajouter un exercice</h2>
            <div class="form-field">
                <label for="customExercise" class="u-visually-hidden">Nom de l'exercice personnalisé</label>
                <input type="text" id="customExercise" class="form-field__input" placeholder="Nom de l'exercice" required>
                <div id="autocompleteSuggestions" class="u-hidden" role="listbox"></div>
            </div>
            <button class="btn btn--success" id="addExerciseBtn" aria-label="Ajouter l'exercice">
                <i class="fa-solid fa-plus" aria-hidden="true"></i>
                <span>Ajouter</span>
            </button>
        </section>

        <section class="summary-section" aria-labelledby="summary-heading">
            <h2 id="summary-heading" class="u-visually-hidden">Résumé de la séance</h2>
            <div class="summary-grid">
                <article class="summary-card">
                    <h3><i class="fa-solid fa-weight-hanging" aria-hidden="true"></i> Tonnage Total</h3>
                    <div class="summary-card__value" id="totalTonnage" aria-live="polite">0 kg</div>
                </article>
                <article class="summary-card">
                    <h3><i class="fa-solid fa-chart-line" aria-hidden="true"></i> Semaine Précédente</h3>
                    <div class="form-field">
                        <label for="previousWeek" class="u-visually-hidden">Tonnage de la semaine précédente</label>
                        <input type="number" id="previousWeek" class="form-field__input" placeholder="Tonnage Préc. (kg)" min="0">
                    </div>
                </article>
                <article class="summary-card">
                    <h3><i class="fa-solid fa-arrow-trend-up" aria-hidden="true"></i> Progression</h3>
                    <div class="summary-card__value" id="delta" aria-live="polite">0 kg</div>
                </article>
                <article class="summary-card">
                    <h3><i class="fa-solid fa-clock" aria-hidden="true"></i> Temps Total</h3>
                    <div class="summary-card__value" id="totalTime" aria-live="polite">00:00:00</div>
                    <button id="toggleWorkoutTimerBtn" class="btn btn--secondary" aria-label="Mettre en pause ou reprendre le minuteur">
                        <i id="timerPlayPauseIcon" class="fa-solid fa-pause" aria-hidden="true"></i>
                        <span id="timerPlayPauseText">Pause</span>
                    </button>
                </article>
            </div>
        </section>

        <section class="session-notes-section" aria-labelledby="notes-heading">
            <h2 id="notes-heading" class="u-visually-hidden">Notes de Séance</h2>
            <div class="form-field">
                <label for="sessionNotes" class="form-field__label">Notes de Séance:</label>
                <textarea id="sessionNotes" class="form-field__textarea" placeholder="Ajouter des notes sur la séance..."></textarea>
            </div>
        </section>
        
        <footer class="page-footer">
            <div class="action-buttons">
              <button class="btn btn--success" id="finishSessionBtn"><i class="fa-solid fa-save" aria-hidden="true"></i> Terminer & Sauvegarder</button>
              <button class="btn btn--primary" id="viewHistoryBtn"><i class="fa-solid fa-book" aria-hidden="true"></i> Historique</button>
              <button class="btn btn--primary" id="plateCalculatorBtn"><i class="fa-solid fa-calculator" aria-hidden="true"></i> Calculateurs</button>
            </div>
            <div class="action-buttons">
                <button class="btn btn--info" id="exportBtn"><i class="fa-solid fa-file-export" aria-hidden="true"></i> Exporter</button>
                <label class="btn btn--info">
                    <i class="fa-solid fa-file-import" aria-hidden="true"></i> Importer
                    <input type="file" id="importFile" class="u-hidden" accept=".json,.csv">
                </label>
            </div>
        </footer>
    </main>
    
    <!-- Notification container for dynamic messages -->
    <div id="notification-container" aria-live="polite" aria-atomic="true"></div>
    
    <!-- PWA Installation Prompt -->
    <aside id="pwaInstallPrompt" class="u-hidden" role="dialog" aria-modal="true" aria-labelledby="pwaInstallTitle">
        <p id="pwaInstallTitle">Ajoutez Lyftiv à votre écran d'accueil !</p>
        <div>
            <button id="installPwaBtn" class="btn btn--primary">Installer</button>
            <button id="closePwaPrompt" class="btn btn--ghost" aria-label="Fermer">&times;</button>
        </div>
    </aside>

    <!-- 
      MODAL STRUCTURE
      - Standardized all modals to use a consistent, accessible structure.
      - Uses .modal__overlay > .modal__content > .modal__header, .modal__body, .modal__footer
    -->
    <div id="historyModal" class="modal__overlay u-hidden" role="dialog" aria-modal="true" aria-labelledby="historyModalTitle">
      <div class="modal__content" role="document">
          <header class="modal__header">
              <h2 id="historyModalTitle" class="modal__title">Historique des Séances</h2>
              <button id="closeHistoryModal" class="btn btn--ghost modal__close-btn" aria-label="Fermer">&times;</button>
          </header>
          <div class="modal__body">
              <div id="historyList">
                  <!-- History items will be injected here by JS -->
              </div>
          </div>
      </div>
    </div>

    <!-- Example: Quick Edit Modal -->
    <div id="quickEditModal" class="modal__overlay u-hidden" role="dialog" aria-modal="true" aria-labelledby="quickEditModalTitle">
        <div class="modal__content" role="document">
            <header class="modal__header">
                <h2 id="quickEditModalTitle" class="modal__title">Édition Rapide</h2>
                <button id="closeQuickEditModal" class="btn btn--ghost modal__close-btn" aria-label="Fermer">&times;</button>
            </header>
            <div class="modal__body">
                <p>Appliquer à toutes les séries de: <strong id="quickEditExerciseName"></strong></p>
                <div class="form-field">
                    <label for="quickEditWeight">Poids (kg)</label>
                    <input type="number" id="quickEditWeight" class="form-field__input" placeholder="Poids (kg)" min="0">
                    <p id="quickEditWeightError" class="form-field__error-message"></p>
                </div>
                <div class="form-field">
                    <label for="quickEditReps">Reps</label>
                    <input type="number" id="quickEditReps" class="form-field__input" placeholder="Reps" min="0">
                    <p id="quickEditRepsError" class="form-field__error-message"></p>
                </div>
            </div>
            <footer class="modal__footer">
                <button class="btn btn--success" id="applyQuickEditBtn">
                    <i class="fa-solid fa-check-circle" aria-hidden="true"></i> Appliquer
                </button>
            </footer>
        </div>
    </div>

    <!-- 
      BOTTOM NAVIGATION (Mobile-only)
      - A <nav> element is more semantic for primary navigation.
      - Buttons are used for actions within the page.
    -->
    <nav class="bottom-nav">
        <button class="bottom-nav__button" id="bottomAddExerciseBtn" aria-label="Ajouter un exercice">
            <i class="fa-solid fa-plus-circle bottom-nav__icon" aria-hidden="true"></i>
            <span class="bottom-nav__label">Exercice</span>
        </button>
        <button class="bottom-nav__button" id="bottomNotesBtn" aria-label="Ouvrir les notes de séance">
            <i class="fa-solid fa-clipboard bottom-nav__icon" aria-hidden="true"></i>
            <span class="bottom-nav__label">Notes</span>
        </button>
        <button class="bottom-nav__button" id="bottomViewHistoryBtn" aria-label="Ouvrir l'historique">
            <i class="fa-solid fa-history bottom-nav__icon" aria-hidden="true"></i>
            <span class="bottom-nav__label">Historique</span>
        </button>
        <button class="bottom-nav__button" id="bottomPlateCalculatorBtn" aria-label="Ouvrir les calculateurs">
            <i class="fa-solid fa-calculator bottom-nav__icon" aria-hidden="true"></i>
            <span class="bottom-nav__label">Calculs</span>
        </button>
        <button class="bottom-nav__button" id="bottomFinishSessionBtn" aria-label="Terminer la séance">
            <i class="fa-solid fa-flag-checkered bottom-nav__icon" aria-hidden="true"></i>
            <span class="bottom-nav__label">Terminer</span>
        </button>
    </nav>
    
</body>
</html>
